sudo: required
os: linux
language: minimal
addons:
  apt:
    packages:
    - docker-ce
git:
  depth: 4
services:
  - docker

before_install:
  - docker pull lacledeslan/gamesvr-warsow

script:
  - docker version
  - docker build --no-cache --tag lltest/gamesvr-warsow-freeplay --tag lacledeslan/gamesvr-warsow-freeplay --build-arg BUILDNODE=TravisCI --build-arg SOURCE_COMMIT="$TRAVIS_COMMIT" -f Dockerfile.linux .
  - docker run -it --rm lltest/gamesvr-warsow-freeplay ./ll-tests/gamesvr-warsow-freeplay.sh

notifications:
  slack:
    secure: tIZifAtb4yUOA9EnqeyBBXy3HkXma+N2NiXeVA8ofaR6VKFQz9p7zGlSbYuB5uUVy6qJTkDw7PP8iAyTf+8hX2yHwjHnN1iKNQYyceGclctpL9XvDxLYSy7JHSbFe1oHFyMUEzYWiqxGlj/kbsR5ZtxvyP/kUZLmmLWHo2EnwpcFppqMNz9YejL2CeCjbtvJr/H5sIzYlzIYcBDSk18CCZsSE2ctZpmTKrgzk00rI+Gc2h21OfF1CBUCO35ufV46SO3gJdkeuOHPGSI39UgGLysyEHK9kK5kcIwZ9YptSmYXFIUkoYfcn0Y2xkH6g5gW7k+FBHhSPMzFCOPmOOBFXZoZjLtWZyWdPZFU4j3S9x4Ez079h+RI8y0mgZndXqAWgC93GAx3BL0NoVl1zGc03xJytXEIx+nSjWeETuD3GxYJpqOZt0nnHhaHUTzHObD9cSa8apuKMQCfynlJODt4Y9TtwYYSuGQH9lgLWP7Bck6QmaapBUdOzhuWNuD5Rt1eWeCVQbgySAA5OM5Q6GqEVQqyFv84P042sUQ60M9lRyFoLECHxrjXKbPaAxwzwtTYAffBDqLEUEX3Q9TOeeypNjw699hg0AWaelH/V5HDAKoMr1N9b7IcytIreULiUeFslhJI7Jv51mesuWUVfl5OoZrWN2Aovvke7uuU01J0p0Q=

before_deploy:
  - echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USER" --password-stdin;
deploy:
  provider: script
  script: docker push lacledeslan/gamesvr-warsow-freeplay
  on:
    branch: master
after_deploy:
  - curl -X POST https://hooks.microbadger.com/images/lacledeslan/gamesvr-hl2dm-freeplay/$MICROBADGER_TOKEN
